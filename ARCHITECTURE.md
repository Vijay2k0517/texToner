# Text Toner - Integration Flow Diagram

## System Architecture

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                    FRONTEND (Flutter)                 â”ƒ
â”ƒ                                                        â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”ƒ
â”ƒ  â”‚         User Interface (chat_screen.dart)    â”‚   â”ƒ
â”ƒ  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”ƒ
â”ƒ  â”‚  â”‚  Welcome Message                        â”‚  â”‚   â”ƒ
â”ƒ  â”‚  â”‚  Quick Actions: Formal | Clarity | Toneâ”‚  â”‚   â”ƒ
â”ƒ  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”ƒ
â”ƒ  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”ƒ
â”ƒ  â”‚  â”‚  Message List                          â”‚  â”‚   â”ƒ
â”ƒ  â”‚  â”‚  â€¢ User messages (right, blue)         â”‚  â”‚   â”ƒ
â”ƒ  â”‚  â”‚  â€¢ Bot messages (left, white)          â”‚  â”‚   â”ƒ
â”ƒ  â”‚  â”‚  â€¢ Typing indicator                    â”‚  â”‚   â”ƒ
â”ƒ  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”ƒ
â”ƒ  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”ƒ
â”ƒ  â”‚  â”‚  Input Field + Send Button             â”‚  â”‚   â”ƒ
â”ƒ  â”‚  â”‚  [Tune] [Type here...] [Send]          â”‚  â”‚   â”ƒ
â”ƒ  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”ƒ
â”ƒ                         â”‚                             â”ƒ
â”ƒ                         â–¼                             â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”ƒ
â”ƒ  â”‚   State Management (chat_provider.dart)      â”‚   â”ƒ
â”ƒ  â”‚   â€¢ Manages messages list                    â”‚   â”ƒ
â”ƒ  â”‚   â€¢ Handles typing state                     â”‚   â”ƒ
â”ƒ  â”‚   â€¢ Formats responses                        â”‚   â”ƒ
â”ƒ  â”‚   â€¢ Checks backend health                    â”‚   â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”ƒ
â”ƒ                         â”‚                             â”ƒ
â”ƒ                         â–¼                             â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”ƒ
â”ƒ  â”‚      API Client (api_client.dart)            â”‚   â”ƒ
â”ƒ  â”‚   â€¢ analyzeTone(text, context)               â”‚   â”ƒ
â”ƒ  â”‚   â€¢ quickAnalyze(text)                       â”‚   â”ƒ
â”ƒ  â”‚   â€¢ getSupportedTones()                      â”‚   â”ƒ
â”ƒ  â”‚   â€¢ healthCheck()                            â”‚   â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”ƒ
â”ƒ                         â”‚                             â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”¿â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
                          â”‚
                  HTTP POST/GET
              (JSON Request/Response)
                          â”‚
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”¿â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                         â–¼                             â”ƒ
â”ƒ               BACKEND (FastAPI)                       â”ƒ
â”ƒ                                                        â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”ƒ
â”ƒ  â”‚         FastAPI Server (main.py)             â”‚   â”ƒ
â”ƒ  â”‚                                               â”‚   â”ƒ
â”ƒ  â”‚  Endpoints:                                   â”‚   â”ƒ
â”ƒ  â”‚  â€¢ POST /analyze-tone                        â”‚   â”ƒ
â”ƒ  â”‚  â€¢ POST /quick-analyze                       â”‚   â”ƒ
â”ƒ  â”‚  â€¢ GET  /supported-tones                     â”‚   â”ƒ
â”ƒ  â”‚  â€¢ GET  /health                              â”‚   â”ƒ
â”ƒ  â”‚  â€¢ GET  /                                    â”‚   â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”ƒ
â”ƒ                         â”‚                             â”ƒ
â”ƒ                         â–¼                             â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”ƒ
â”ƒ  â”‚  GeminiTextToningAnalyzer Class              â”‚   â”ƒ
â”ƒ  â”‚   â€¢ initialize()                             â”‚   â”ƒ
â”ƒ  â”‚   â€¢ analyze_tone_and_enhance()               â”‚   â”ƒ
â”ƒ  â”‚   â€¢ parse_tone_analysis_response()           â”‚   â”ƒ
â”ƒ  â”‚   â€¢ _build_analysis_prompt()                 â”‚   â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”ƒ
â”ƒ                         â”‚                             â”ƒ
â”ƒ                         â–¼                             â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”ƒ
â”ƒ  â”‚         Google Gemini AI API                 â”‚   â”ƒ
â”ƒ  â”‚   â€¢ model.generate_content(prompt)           â”‚   â”ƒ
â”ƒ  â”‚   â€¢ Returns structured analysis              â”‚   â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”ƒ
â”ƒ                                                        â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
```

---

## Request Flow

### 1. User Sends Message

```
User types: "I'm really excited about this project!"
         â”‚
         â–¼
[Chat Screen] captures text input
         â”‚
         â–¼
[Chat Provider] calls sendMessageToBackend()
         â”‚
         â”œâ”€â†’ Adds user message to UI immediately
         â”‚
         â””â”€â†’ Shows typing indicator
```

### 2. API Request

```
[API Client] builds request:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /analyze-tone                  â”‚
â”‚ Content-Type: application/json      â”‚
â”‚                                     â”‚
â”‚ {                                   â”‚
â”‚   "text": "I'm really excited...", â”‚
â”‚   "context": null                   â”‚
â”‚ }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ HTTP Request
[FastAPI Server] receives request
```

### 3. Backend Processing

```
[FastAPI Endpoint: /analyze-tone]
         â”‚
         â–¼
Validates request (Pydantic model)
         â”‚
         â–¼
[GeminiTextToningAnalyzer]
         â”‚
         â”œâ”€â†’ Checks if initialized
         â”œâ”€â†’ Applies rate limiting
         â””â”€â†’ Builds analysis prompt
                  â”‚
                  â–¼
         [Google Gemini API]
                  â”‚
                  â”œâ”€â†’ Analyzes tone
                  â”œâ”€â†’ Determines confidence
                  â”œâ”€â†’ Generates enhanced versions
                  â””â”€â†’ Creates suggestions
                           â”‚
                           â–¼
         Returns structured response
```

### 4. Response Processing

```
[FastAPI] parses Gemini response
         â”‚
         â–¼
Creates ToneAnalysisResponse:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ {                                    â”‚
â”‚   "original_text": "...",            â”‚
â”‚   "detected_tone": "enthusiastic",   â”‚
â”‚   "confidence": 0.85,                â”‚
â”‚   "tone_category": "enthusiastic",   â”‚
â”‚   "enhanced_versions": [             â”‚
â”‚     {"tone": "Formal", "text": "..."â”‚
â”‚     {"tone": "Casual", "text": "..."â”‚
â”‚     {"tone": "Professional", ...}    â”‚
â”‚   ],                                 â”‚
â”‚   "suggestions": ["...", "..."],     â”‚
â”‚   "explanation": "..."               â”‚
â”‚ }                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ HTTP Response
[API Client] receives JSON
```

### 5. UI Update

```
[API Client] parses response
         â”‚
         â–¼
[Chat Provider] formats message
         â”‚
         â”œâ”€â†’ Adds emojis for tone
         â”œâ”€â†’ Formats enhanced versions
         â”œâ”€â†’ Formats suggestions as bullets
         â””â”€â†’ Creates formatted text
                  â”‚
                  â–¼
         Adds bot message to UI
                  â”‚
                  â–¼
         Hides typing indicator
                  â”‚
                  â–¼
[Chat Screen] displays formatted response:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¯ Tone Analysis Complete!         â”‚
â”‚                                    â”‚
â”‚ Detected Tone: ğŸ‰ Enthusiastic    â”‚
â”‚                (85% confidence)    â”‚
â”‚ Category: enthusiastic             â”‚
â”‚                                    â”‚
â”‚ Analysis:                          â”‚
â”‚ The text shows high enthusiasm...  â”‚
â”‚                                    â”‚
â”‚ âœ¨ Enhanced Versions:              â”‚
â”‚                                    â”‚
â”‚ 1. Formal:                         â”‚
â”‚ I am pleased to express...         â”‚
â”‚                                    â”‚
â”‚ 2. Casual:                         â”‚
â”‚ This is so cool! Can't wait!       â”‚
â”‚                                    â”‚
â”‚ 3. Professional:                   â”‚
â”‚ I am very interested in...         â”‚
â”‚                                    â”‚
â”‚ ğŸ’¡ Suggestions:                    â”‚
â”‚ â€¢ Consider your audience           â”‚
â”‚ â€¢ Maintain enthusiasm while...     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User   â”‚â”€â”€1â”€â”€â–¶â”‚ Flutter  â”‚â”€â”€2â”€â”€â–¶â”‚ FastAPI  â”‚â”€â”€3â”€â”€â–¶â”‚  Gemini  â”‚
â”‚  Input   â”‚      â”‚   App    â”‚      â”‚  Server  â”‚      â”‚    AI    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚                 â”‚                 â”‚
                        â”‚                 â”‚                 â”‚
                   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
                   â”‚ Display â”‚â—€â”€â”€6â”€â”€â”€â”‚  Parse  â”‚â—€â”€â”€5â”€â”€â”‚ Analyze â”‚
                   â”‚ Result  â”‚       â”‚Response â”‚      â”‚  & Gen  â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. User types message and clicks send
2. Frontend sends HTTP POST with JSON body
3. Backend forwards to Gemini with structured prompt
4. Gemini analyzes and returns structured response
5. Backend parses and validates response
6. Frontend displays formatted analysis
```

---

## Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User sends text â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Client makes requestâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â–¶ Network Error â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                           â”‚
         â”œâ”€â”€â–¶ Timeout Error â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚                           â”‚
         â”œâ”€â”€â–¶ Server Error (5xx) â”€â”€â”€â”€â”¤
         â”‚                           â”‚
         â”œâ”€â”€â–¶ Client Error (4xx) â”€â”€â”€â”€â”¤
         â”‚                           â”‚
         â””â”€â”€â–¶ Success (200-299) â”€â”€â”  â”‚
                                  â”‚  â”‚
                                  â–¼  â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ Error Handler  â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼             â–¼             â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Show    â”‚   â”‚  Log    â”‚   â”‚  Add    â”‚
              â”‚ SnackBarâ”‚   â”‚  Error  â”‚   â”‚  Bot    â”‚
              â”‚         â”‚   â”‚         â”‚   â”‚ Message â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## State Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ChatProvider (ChangeNotifier)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                â”‚
â”‚  State:                                        â”‚
â”‚  â€¢ _messages: List<Message>                    â”‚
â”‚  â€¢ _isTyping: bool                             â”‚
â”‚  â€¢ _supportedTones: List<String>               â”‚
â”‚  â€¢ _apiClient: ApiClient                       â”‚
â”‚                                                â”‚
â”‚  Methods:                                      â”‚
â”‚  â€¢ addUserMessage(text)                        â”‚
â”‚  â€¢ addBotMessage(...)                          â”‚
â”‚  â€¢ sendMessageToBackend(text, context)         â”‚
â”‚  â€¢ setTyping(bool)                             â”‚
â”‚  â€¢ initialize()                                â”‚
â”‚  â€¢ checkBackendHealth()                        â”‚
â”‚                                                â”‚
â”‚  Notifies:                                     â”‚
â”‚  â€¢ When message added                          â”‚
â”‚  â€¢ When typing state changes                   â”‚
â”‚  â€¢ When supported tones fetched                â”‚
â”‚                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                             â”‚
         â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Chat Screen     â”‚          â”‚  Input Field     â”‚
â”‚  (Consumer)      â”‚          â”‚  (Consumer)      â”‚
â”‚                  â”‚          â”‚                  â”‚
â”‚  Rebuilds when:  â”‚          â”‚  Rebuilds when:  â”‚
â”‚  â€¢ Message added â”‚          â”‚  â€¢ Typing state  â”‚
â”‚  â€¢ Typing change â”‚          â”‚    changes       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Security & Configuration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Environment Variables        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  Backend (.env)                     â”‚
â”‚  â”œâ”€ GEMINI_API_KEY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â–¶ [Never committed]
â”‚  â””â”€ (Optional configs)              â”‚
â”‚                                     â”‚
â”‚  Frontend (Dart define)             â”‚
â”‚  â””â”€ API_BASE_URL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â–¶ [Runtime override]
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           CORS Middleware           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  allow_origins: ["*"]               â”‚
â”‚  allow_credentials: True            â”‚
â”‚  allow_methods: ["*"]               â”‚
â”‚  allow_headers: ["*"]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Key Integration Points

### 1. Endpoint Matching âœ…

```
Frontend: POST to /analyze-tone
Backend:  @app.post("/analyze-tone")
```

### 2. Request Format âœ…

```
Frontend sends:  {"text": "...", "context": "..."}
Backend expects: {"text": str, "context": Optional[str]}
```

### 3. Response Structure âœ…

```
Backend returns: ToneAnalysisResponse (Pydantic)
Frontend parses: ToneAnalysisResponse.fromJson()
```

### 4. Data Models âœ…

```
Backend: enhanced_versions: List[Dict[str, str]]
Frontend: enhancedVersions: List<EnhancedVersion>
```

### 5. Error Handling âœ…

```
Backend: HTTPException with detail
Frontend: Catches and displays user-friendly message
```

---

**This architecture ensures perfect compatibility between frontend and backend! âœ…**
